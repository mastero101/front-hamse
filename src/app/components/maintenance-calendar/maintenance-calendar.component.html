<div class="calendar-container">
    <div class="cards-wrapper" [class.yearly-view]="currentView === 'yearly'">
        <!-- Left Column -->
        <div class="left-column" *ngIf="currentView !== 'yearly'">
            <!-- Activities Card -->
            <div class="card activities-card">
                <div class="circle-container">
                    <div class="progress-circle">
                        <span class="percentage">{{completionPercentage}}%</span>
                        <div class="circle-dot"></div>
                    </div>
                    <div class="info-container">
                        <div class="title-section">
                            <h2>{{ currentView === 'weekly' ? 'Actividades Semanales' : 'Actividades' }}</h2>
                            <p>{{ currentView === 'weekly' ? 
                                'Semana del ' + (currentWeekStart | date:'d') + ' al ' + (currentWeekEnd | date:'d') + ' de ' + (currentWeekEnd | date:'MMMM yyyy') :
                                '24 de Febrero 2025' }}</p>
                        </div>
                        <div class="button-group">
                            <button class="btn-orange">
                                <i class="fas fa-calendar"></i>
                                <span>Indicar periodo</span>
                            </button>
                            <button class="btn-orange" (click)="printCalendar()">
                                <i class="fas fa-print"></i>
                                <span>Imprimir</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Card -->
            <div class="card calendar-card">
                @if (currentView === 'weekly') {
                    <div class="week-view">
                        <div class="week-header">
                            <button class="btn-nav" (click)="previousWeek()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="week-label">Semana {{ currentWeekStart | date:'w' }}</div>
                            <button class="btn-nav" (click)="nextWeek()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="week-days">
                            @for (day of weekDays; track day) {
                                <div class="week-day" [class.today]="isToday(day)" >
                                    <span class="day-name">{{ day | date:'EEE' }}</span>
                                    <span class="day-number">{{ day | date:'d' }}</span>
                                </div>
                            }
                        </div>
                    </div>
                } @else if (currentView === 'monthly') {
                    <div class="month-view">
                        <div class="year-header">
                            <span class="year-label">{{ currentYear }}</span>
                        </div>
                        <div class="selected-month-label" style="text-align: center; margin-bottom: 18px;">
                            <strong>Mes seleccionado:</strong> {{ currentMonthName | titlecase }} de {{ currentYear }}
                        </div>
                        <div class="months-grid">
                            @for (month of months; track month.name) {
                                <div class="month-cell"
                                     [class.active]="month.name === currentMonthName"
                                     [class.completed]="month.completed"
                                     (click)="selectMonth(month.name)">
                                    <span class="month-name">{{month.name}}</span>
                                    <i *ngIf="month.completed" class="fas fa-check"></i>
                                </div>
                            }
                        </div>
                    </div>
                } @else {
                    <!-- Asumiendo que este bloque es para la vista mensual detallada -->
                    <div class="month-view-calendar"> <!-- Usando la estructura sugerida anteriormente -->
                        <div class="month-header">
                            <button class="btn-nav" (click)="previousMonth()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <!-- Asegúrate que currentMonthName and currentYear se actualizan correctamente -->
                            <span class="month-year-label">{{ currentMonthName | titlecase }} {{ currentYear }}</span>
                            <button class="btn-nav" (click)="nextMonth()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="calendar-grid">
                            <div class="weekdays">
                                <span>Lun</span>
                                <span>Mar</span>
                                <span>Mie</span>
                                <span>Jue</span>
                                <span>Vie</span>
                                <span>Sab</span>
                                <span>Dom</span>
                            </div>
                            <div class="days-grid monthly"> <!-- Usando la clase 'monthly' -->
                                <!-- Corregido el @for y las propiedades -->
                                @for (day of calendarDays; track day.date) {
                                <div class="day-cell"
                                     [class.other-month]="!day.isCurrentMonth"
                                     [class.today]="day.isToday"
                                     [class.selected]="day.isSelected"
                                     (click)="selectDayFromMonthView(day)">
                                    {{ day.dayOfMonth }} <!-- Usar dayOfMonth -->
                                    <!-- Ícono de campana eliminado de aquí, 'today' ya aplica clase -->
                                    <!-- Lógica de 'completed' eliminada, no está en la interfaz -->
                                </div>
                                }
                            </div>
                        </div>
                    </div>
                }
                <div class="notification-box">
                    <p>CRE amplía plazo para regularizaciones de estaciones de servicio. Dicho acuerdo amplía el plazo
                        para regularizar dichas acciones del 17 de diciembre de 2024 al 17 de marzo de 2025.</p>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="right-column" [class.expanded]="currentView === 'yearly'">
            <div class="card activities-list-card">
                <div class="tab-group">
                    <button class="tab" [class.active]="currentView === 'daily'" (click)="changeView('daily')">Diarias</button>
                    <button class="tab" [class.active]="currentView === 'weekly'" (click)="changeView('weekly')">Semanal</button>
                    <button class="tab" [class.active]="currentView === 'monthly'" (click)="changeView('monthly')">Mensual</button>
                    <button class="tab" [class.active]="currentView === 'yearly'" (click)="changeView('yearly')">Anual</button>
                </div>
                <div class="list-header">
                    <h3>{{ getViewTitle() }}</h3>
                    <div class="button-actions">
                        @if (currentView === 'yearly') {
                            <button class="btn-orange" (click)="printCalendar()">
                                <i class="fas fa-print"></i>
                                <span>Imprimir</span>
                            </button>
                        }
                        <button class="btn-save" (click)="saveActivities()" [disabled]="!currentScheduleId">
                            <i class="fas fa-save"></i>
                            Guardar
                        </button>
                    </div>
                </div>
                <div class="activities-list" [ngClass]="currentView">
                    @if (activities.length === 0) {
                        <div class="loading-message">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Cargando actividades...</span>
                        </div>
                    } @else {
                        @for (activity of activities; track activity.id) {
                            <div class="activity-row">
                                <div class="activity-text">
                                    <i class="fas fa-arrow-right"></i>
                                    <span>{{activity.name}}</span>
                                </div>
                                <div class="status-group">
                                    <span class="status-text" [ngClass]="activity.status">
                                        {{ activity.status === 'sin_revision' ? 'Sin revisión' :
                                        activity.status === 'verificado' ? 'Verificado' : 'No aplica' }}
                                    </span>
                                    <div class="checkbox" [ngClass]="activity.status" (click)="toggleActivityStatus(activity)">
                                        <i class="fas fa-check check-icon"></i>
                                        <i class="fas fa-times times-icon"></i>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                </div>

                <!-- Reminder Section -->
                <div class="reminder-section">
                    <div class="reminder-content">
                        <div class="reminder-header">
                            <i class="fas fa-bell"></i>
                            <div class="reminder-text">
                                <h4>Recordatorio:</h4>
                                <p>Actividad ASEA 1</p>
                            </div>
                        </div>
                        <img src="../../../assets/images/ASEA1_Actividad.png" alt="Hamse Logo" class="reminder-logo">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>